{% extends "base.html" %}

{% block extra_head %}
<!-- DataTables CSS -->
<link rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
{% endblock %}

{% block content %}
<h2>Citas programadas</h2>

<table id="appointmentsTable"
       class="table table-dark table-striped table-sm align-middle mt-4">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Hora</th>
      <th>Timestamp</th>
      <th>Cliente</th>
      <th>Teléfono</th>
      <th>Placa</th>
      <th>Servicios</th>
      <th>Fin estimado</th>
      <th>Acciones</th>
    </tr>
  </thead>

  <tbody>
  {% for a in appointments %}
    <tr>
      <td>{{ a.start_datetime.strftime("%Y-%m-%d") }}</td>
      <td>{{ a.start_datetime.strftime("%H:%M") }}</td>

      <!-- Timestamp -->
      <td>{{ a.start_datetime.strftime("%Y-%m-%d %H:%M") }}</td>

      <td>{{ a.customer_name }}</td>
      <td>{{ a.phone or "-" }}</td>
      <td>{{ a.plate or "-" }}</td>
      <td>{{ a.services }}</td>
      <td>{{ a.end_datetime.strftime("%H:%M") }}</td>

      <td class="d-flex gap-2">
        <a href="{{ url_for('edit_appointment', appointment_id=a.id) }}"
          class="btn btn-sm btn-outline-info">Editar</a>

        <form method="post"
              action="{{ url_for('delete_appointment', appointment_id=a.id) }}"
              onsubmit="return confirm('¿Eliminar esta cita?');">
          <button class="btn btn-sm btn-outline-danger">Eliminar</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

{% endblock %}

{% block extra_scripts %}
<!-- DataTables JS -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function() {
    $("#appointmentsTable").DataTable({
        pageLength: 50,
        order: [[2, "desc"]], // Ordenar por timestamp
        columnDefs: [
            { targets: 2, visible: false },  // Ocultar columna Timestamp (pero sirve para ordenamiento)
        ],
        language: {
            search: "Filtrar:",
            lengthMenu: "Mostrar _MENU_ registros",
            info: "Mostrando _START_ a _END_ de _TOTAL_ citas",
            paginate: {
              previous: "Anterior",
              next: "Siguiente"
            }
        }
    });
});
</script>
{% endblock %}